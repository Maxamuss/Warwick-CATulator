{% extends 'base.html' %}

{% block title %}
    Select Module (1/3)    
{% endblock %}

{% block content %}
    <div class="container">
        <form method="POST">
            {% csrf_token %}
            <div>
                <h2 class="font-weight-light"><a href="{% url 'dashboard' %}"><i class="fas fa-arrow-left"></i></a> 1) Select Module <i id="check-1" class="fas fa-check" style="display: none;"></i></h2>
                <p class="text-muted">Please select a module from the dropdown as well as the academic year in which you took it.</p>
                {{ form }}
            </div>
            <div id="assessment_group_div">
                <div id="assessment_group_table"></div>
                <button type="button" id="select_assessment_group" class="btn btn-primary btn-block" style="display: none">Next</button>
            </div>
            <div id="assessment_result_div">
                <div id="assessment_result_input"></div>
            </div>
        </form>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        $("#id_module_code, #id_academic_year").change(function () {
            $("#assessment_group_div").hide();
            $("#assessment_result_div").hide();
            $("#input[name=groups]").prop("readonly", false);

            var module_code = $("#id_module_code").find(":selected").text();
            var academic_year = $("#id_academic_year").val();

            $.ajax({
                type: 'GET',
                url: '{% url 'get_assessment_group' %}',
                data: {
                    'module_code': module_code,
                    'academic_year': academic_year
                },
                success: function (data) {
                    $("#assessment_group_div").show();
                    $('#assessment_group_table').html(data);
                    $('#select_assessment_group').show();
                    $('#check-1').show();
                },
                error: function(err) {
                    $('#check-1').hide();
                }
            });
        });

        $("#select_assessment_group").click(function () {
            var assessment_group_id = $('input[name=groups]:checked').val();

            $.ajax({
                type: 'GET',
                url: '{% url 'get_assessments' %}',
                data: {
                    'assessment_group_id': assessment_group_id
                },
                success: function (data) {
                    $("#assessment_result_div").show();
                    $('#assessment_result_input').html(data);
                    $('#select_assessment_group').hide();
                    $(':radio:not(:checked)').attr('disabled', true);
                    $('#check-2').show();
                }
            });
        });
    </script>
{% endblock %}