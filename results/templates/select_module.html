{% extends 'base.html' %}

{% block title %}
    Select Module (1/3)    
{% endblock %}

{% block content %}
    <div class="container">
        <form method="POST">
            {% csrf_token %}
            <div>
                <h1>Select Module</h1>
                {{ form }}
            </div>
            <div id="assessment_group_div">
                <div id="assessment_group_table"></div>
                <button type="button" id="select_assessment_group" style="display: none">Next</button>
            </div>
            <div id="assessment_result_div">
                <div id="assessment_result_input"></div>
            </div>
        </form>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        $("#id_module_code, #id_academic_year").change(function () {
            $("#assessment_group_div").hide();
            $("#assessment_result_div").hide();

            var module_code = $("#id_module_code").find(":selected").text();
            var academic_year = $("#id_academic_year").val();

            $.ajax({
                type: 'GET',
                url: '{% url 'get_assessment_group' %}',
                data: {
                    'module_code': module_code,
                    'academic_year': academic_year
                },
                success: function (data) {
                    $("#assessment_group_div").show();
                    $('#assessment_group_table').html(data);
                    $('#select_assessment_group').show();
                }
            });
        });

        $("#select_assessment_group").click(function () {
            var assessment_group_id = $('input[name=groups]:checked').val();

            $.ajax({
                type: 'GET',
                url: '{% url 'get_assessments' %}',
                data: {
                    'assessment_group_id': assessment_group_id
                },
                success: function (data) {
                    $("#assessment_result_div").show();
                    $('#assessment_result_input').html(data);
                }
            });
        });
    </script>
{% endblock %}